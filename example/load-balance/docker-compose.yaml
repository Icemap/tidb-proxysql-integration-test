version: "3"
services:
  tidb-0:
    image: pingcap/tidb:v6.1.0
    volumes:
    - "./tidb-config.toml:/tidb-config.toml"
    ports:
      - 4001:4000
    command: /tidb-server -config /tidb-config.toml -store unistore -path "" -lease 0s > tidb.log 2>&1 &
  tidb-1:
    image: pingcap/tidb:v6.1.0
    volumes:
    - "./tidb-config.toml:/tidb-config.toml"
    ports:
      - 4002:4000
    command: /tidb-server -config /tidb-config.toml -store unistore -path "" -lease 0s > tidb.log 2>&1 &
  tidb-2:
    image: pingcap/tidb:v6.1.0
    volumes:
    - "./tidb-config.toml:/tidb-config.toml"
    ports:
      - 4003:4000
    command: /tidb-server -config /tidb-config.toml -store unistore -path "" -lease 0s > tidb.log 2>&1 &
  proxysql:
    image: proxysql/proxysql:latest
    volumes:
    - "./proxysql-load-balance.cnf:/etc/proxysql.cnf"
    depends_on:
      - tidb-0
      - tidb-1
      - tidb-2
    links:
      - tidb-0
      - tidb-1
      - tidb-2
    ports:
    - "6034:6033"